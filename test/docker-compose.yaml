version: "3"

services:
  nginx-s3-gateway:
    # If minio client is up and running properly, we are reasonably sure that
    # minio has properly started. That's why we depend on it here.
    depends_on:
      minio:
        condition: service_healthy
    image: "nginx-s3-gateway"
    ports:
      - "8989:${NGINX_INTERNAL_PORT-80}/tcp"
    links:
      - "minio"
    restart: "no"
    environment:
      S3_BUCKET_NAME: "bucket-1"
      S3_ACCESS_KEY_ID: "AKIAIOSFODNN7EXAMPLE"
      S3_SECRET_KEY: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
      S3_SESSION_TOKEN: "TamporarySessionToken3QtMSJGMEQCIHAJKTeBFyNhZFZqhFj6X+BTSEHKbaS//qFOGAeipEtuAiA4sm686RKllfdYk/md+Hu1WUaUenaRhBVxtDTumuCquyqNAwj2//////////8BEAIaDDY0MTIyMjIzMDE1MSIM+z+fRgMCA3mRHuTmKuECEMof0THnvof1HcMsv1n7b4oJJCRkxpQpdvWwBkCmi1MF5EMERTpzp0E5vHVBlepeGH8xSAyVrtC48z5AmoncR1PQ4G1/W6fdHfbEbzI6QlcoefHXe0oxkSTQBkkgQcEa4st8G0JZ8XrqSEAYTFljx2yHXm4jORgS5C4I9YjzDuf8iztNCXkC1RBXEgD00cFeSI5J8b6/LGG+G8RIYzFGaTOuBIGezvebQmkyuCaIWU36glcjdtBQ8B6DiLcg9eD3yKJiigVeL3JtkWLUByEVOgIEJM+VWMn7fm5LpNUqwFWZGWUI/sVgMHVQFnbGwvfdrz228wQWUziRuWZio+MqqfhrJQlip++qSRELHw3GCku5+yfFTCKYPIDvVe5ZZfNs5RsjA0gfI+xPRLGf3YDkYzDujDXQV65fGmSC1nAhQzlBa/mZriY2S6UmOVZX9v1viyTQsP4pWIwLcovmpvUOX60w96TfnwY6pwGUT2l3wUDHgr35OOmcZPjZaACGKmai6JKHCP1sPUDZKTN2hZRyPGrp77hae2+SMNU6Nj0Z+YJCViWVrcw5wgMc1kC/MkWWYlIjym/IR4dnCSM2pFJAC0aj3KcbcjBvqeSWIMmoUv7UTT1/T53u0VXznowk3OUDnCA5xYwX6O5KY1V0mgYU/BiRrhQ8jYu9ljUDKscK+x8CxEhKGn8uNV+hE2Pnx1TaMQ=="
      S3_SERVER: "minio"
      S3_SERVER_PORT: "9000"
      S3_SERVER_PROTO: "http"
      S3_REGION: "us-east-1"
      S3_DEBUG: "true"
      S3_STYLE: "virtual"
      ALLOW_DIRECTORY_LIST:
      PROVIDE_INDEX_PAGE:
      APPEND_SLASH_FOR_POSSIBLE_DIRECTORY:
      AWS_SIGS_VERSION:
      STATIC_SITE_HOSTING:
      PROXY_CACHE_VALID_OK: "1h"
      PROXY_CACHE_VALID_NOTFOUND: "1m"
      PROXY_CACHE_VALID_FORBIDDEN: "30s"

  minio:
    image: "minio/minio:RELEASE.2021-02-19T04-38-02Z"
    ports:
      - "9090:9000/tcp"
    restart: "no"
    command: "server --address :9000 /data"
    environment:
      MINIO_ACCESS_KEY: "AKIAIOSFODNN7EXAMPLE"
      MINIO_SECRET_KEY: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
      MINIO_REGION_NAME: "us-east-1"
      MINIO_DOMAIN: "minio"
      MINIO_BROWSER: "off"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 5s
      timeout: 3s
      retries: 3
  # It may be useful to enable minio client so that you can debug what calls
  # were made to minio by the gateway.
#  minio-client:
#    depends_on:
#      - "minio"
#    image: "minio/mc"
#    restart: "no"
#    command: "admin trace --verbose nginx-test-gateway"
#    environment:
#      MC_HOST_nginx-test-gateway: "http://AKIAIOSFODNN7EXAMPLE:wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY@minio:9000"
